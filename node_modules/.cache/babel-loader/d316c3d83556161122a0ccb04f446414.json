{"ast":null,"code":"var _jsxFileName = \"/Users/Gary 1/Desktop/Code stuff/\\u8CC7\\u7B56\\u6703/\\u5C08\\u984C/\\u5927\\u5C08/artddict-react/src/pages/user/PwdEdit.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { withRouter, Link, NavLink } from 'react-router-dom';\nimport { Container } from 'react-bootstrap'; // style\n\nimport './styles/PwdEdit.scss'; // import Menu2 from './components/Menu2'\n\nimport Logoheader from './components/Logoheader';\nimport Breadcrumb from './components/UserBreadcrumb'; // SweetAlert\n\nimport swal from 'sweetalert';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction PwdEdit(props) {\n  _s();\n\n  const userid = props.match.params.userid;\n  const [dataLoading, setDataLoading] = useState(false);\n  const [password, setPassword] = useState('');\n  const [newPwd1, setNewPwd1] = useState('');\n  const [newPwd2, setNewPwd2] = useState('');\n  const [id, setId] = useState('');\n  console.log('before get request');\n\n  async function getUserFromServer(userid) {\n    // 開啟載入指示\n    setDataLoading(true); // 連接的伺服器資料網址\n\n    const url = 'http://localhost:6005/users/' + userid; // 注意header資料格式要設定，伺服器才知道是json格式\n\n    const request = new Request(url, {\n      method: 'GET',\n      headers: new Headers({\n        Accept: 'application/json',\n        'Content-Type': 'appliaction/json'\n      })\n    });\n    const response = await fetch(request);\n    const data = await response.json();\n    console.log(`[GET] response = ${data}`);\n    setPassword(data.password);\n    setId(data.id);\n  }\n\n  async function checkedPassword(pwd1, pwd2) {\n    if (pwd1 === pwd2 && pwd2 != '') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  async function logoutToSever() {\n    // 連接的伺服器資料網址\n    localStorage.removeItem('token');\n    const url = 'http://localhost:6005/users/logout'; // 注意資料格式要設定，伺服器才知道是json格式\n\n    const request = new Request(url, {\n      method: 'GET',\n      headers: new Headers({\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      })\n    }); // 要等驗証過，再設定資料(簡單的直接設定)\n\n    swal({\n      text: '登出成功！',\n      icon: 'success',\n      button: false,\n      timer: 3000\n    });\n    const response = await fetch(request); // const data = await response.json()\n  }\n\n  async function updatePwdToSever() {\n    // 開啟載入指示\n    setDataLoading(true); // 檢查新密碼==再次輸入密碼\n    // 檢查成功, 才送request\n\n    if (await checkedPassword(newPwd1, newPwd2)) {\n      // var new_password = newPwd1\n      const newData = {\n        password: newPwd1\n      }; // 連接的伺服器資料網址 (node端的門牌號碼)\n      // node = http://localhost:6005/users/ + route.get(門牌)\n      // node = http://localhost:6005/users/ + route.put(門牌)\n      // node = http://localhost:6005/users/ + route.post(門牌)\n\n      const url = 'http://localhost:6005/users/pwd/' + userid; // 以下實際發出request\n      // 注意資料格式要設定，伺服器才知道是json格式\n\n      const request = new Request(url, {\n        method: 'PUT',\n        body: JSON.stringify(newData),\n        // request:\n        //    header\n        //    body\n        headers: new Headers({\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n        })\n      });\n      console.log(`request header = ${request.headers}`);\n      console.log(`request body = ${request.body}`); // if (newData.password != null) {\n\n      const response = await fetch(request);\n      const data = await response.json(); // } else {\n      //   alert(password)\n      // }\n      // end if\n\n      console.log('伺服器回傳的json資料', data); // 要等驗証過，再設定資料(簡單的直接設定)\n      //直接在一段x秒關掉指示器\n\n      setTimeout(() => {\n        setDataLoading(false);\n        swal({\n          text: '密碼修改成功！！！',\n          icon: 'success',\n          button: false,\n          timer: 3000\n        });\n      }, 1000);\n    } else {\n      // 抓出了空字串或者兩行不同 警訊以下內容\n      setDataLoading(false);\n      swal({\n        text: '密碼有誤, 請重新檢查',\n        icon: 'error',\n        button: false,\n        timer: 3000\n      });\n    }\n  } // 一開始就會開始載入資料\n\n\n  useEffect(() => {\n    getUserFromServer(userid);\n  }, []); // 每次users資料有變動就會X秒後關掉載入指示\n\n  useEffect(() => {\n    setTimeout(() => {\n      setDataLoading(false);\n    }, 1000);\n  }, [userid]);\n\n  const loading = /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"u-body\",\n      children: [/*#__PURE__*/_jsxDEV(Logoheader, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex justify-content-center\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"spinner-border\",\n          role: \"status\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"sr-only\",\n            children: \"Loading...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n\n  const display = /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"u-body\",\n      children: [/*#__PURE__*/_jsxDEV(Logoheader, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"u-breadcrumb\",\n        children: /*#__PURE__*/_jsxDEV(Breadcrumb, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tab-bar\",\n        children: [/*#__PURE__*/_jsxDEV(NavLink, {\n          activeClassName: \"activenav\",\n          className: 'tab',\n          to: `/user-msgedit/${id}`,\n          style: {\n            textDecoration: 'none',\n            background: 'black',\n            color: 'white'\n          },\n          children: \"\\u4FEE\\u6539\\u8CC7\\u6599\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(NavLink, {\n          activeClassName: \"activenav\",\n          className: 'tab',\n          to: `/user-orderpro/${id}`,\n          style: {\n            textDecoration: 'none'\n          },\n          children: \"\\u8A02\\u55AE\\u67E5\\u8A62\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(NavLink, {\n          activeClassName: \"activenav\",\n          className: 'tab',\n          to: `/user-coupon/${id}`,\n          style: {\n            textDecoration: 'none'\n          },\n          children: \"\\u6211\\u7684\\u512A\\u60E0\\u5238\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(NavLink, {\n          activeClassName: \"activenav\",\n          className: 'tab',\n          to: `/user-ticket/${id}`,\n          style: {\n            textDecoration: 'none'\n          },\n          children: \"\\u6211\\u7684\\u7968\\u5238\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(NavLink, {\n          activeClassName: \"activenav\",\n          className: 'tab',\n          to: `/user-myfav/${id}`,\n          style: {\n            textDecoration: 'none'\n          },\n          children: \"\\u6211\\u7684\\u6536\\u85CF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(NavLink, {\n          activeClassName: \"activenav\",\n          className: 'tab',\n          to: `/user-auction/${userid}`,\n          style: {\n            textDecoration: 'none'\n          },\n          children: \"\\u7AF6\\u6A19\\u67E5\\u8A62\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(NavLink, {\n          activeClassName: \"activenav\",\n          className: 'tab',\n          to: \"/user-login\",\n          onClick: () => {\n            logoutToSever();\n          },\n          style: {\n            textDecoration: 'none'\n          },\n          children: \"\\u767B\\u51FA\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Container, {\n        fluid: true,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex u-row justify-content-around\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"u-usertitleLeft\",\n            children: /*#__PURE__*/_jsxDEV(Link, {\n              to: `/user-msgedit/${id}`,\n              children: \"\\u6703\\u54E1\\u8CC7\\u6599\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 251,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"u-usertitleRight\",\n            children: /*#__PURE__*/_jsxDEV(Link, {\n              to: `/user-pwdedit/${id}`,\n              children: \"\\u4FEE\\u6539\\u5BC6\\u78BC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 257,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"u-userData col-6 mt-5\",\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group u-form1 mt-5\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              value: newPwd1,\n              type: \"password\",\n              className: \"form-control\",\n              placeholder: \"\\u8ACB\\u8F38\\u5165\\u65B0\\u5BC6\\u78BC\",\n              onChange: event => {\n                setNewPwd1(event.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group u-form1 mt-5\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              value: newPwd2,\n              type: \"password\",\n              className: \"form-control\",\n              placeholder: \"\\u518D\\u6B21\\u8F38\\u5165\\u65B0\\u5BC6\\u78BC\",\n              onChange: event => {\n                setNewPwd2(event.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"u-editBtn\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"btn btn-outline-dark \",\n              onClick: () => {\n                updatePwdToSever();\n              },\n              children: \"\\u4FEE\\u6539\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n\n  async function getjwtvertifyFromServer() {\n    const token = localStorage.getItem('token');\n    const response = await fetch('http://localhost:6005/users/checklogin', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        token\n      })\n    });\n    const data = await response.json();\n    console.log('check login response = ', data);\n    console.log('data.id = ', data.id);\n    console.log('userid = ', userid);\n\n    if (data.id == userid) {\n      var stat = true;\n    } else {\n      var stat = false;\n    }\n\n    console.log('stat = ', stat);\n    return stat;\n  } // async needs to be waited in another funciton\n\n\n  const waitAsync = async () => {\n    const isLoggedin = await getjwtvertifyFromServer();\n\n    if (!isLoggedin) {\n      console.log('no display!');\n      swal({\n        title: '登入驗證失敗',\n        text: '您的登入驗證已過期或者尚未登入, 請重新登入\\n正在將您導向登入頁面 ...',\n        button: false,\n        timer: 2000\n      });\n      setTimeout(() => {\n        window.location.replace(`../user-login/`);\n      }, 500); // throw new Error('Oopsie woopsie')\n    }\n  };\n\n  if (waitAsync()) {\n    // setDataLoading(true)\n    console.log('display!');\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: dataLoading ? loading : display\n    }, void 0, false);\n  }\n}\n\n_s(PwdEdit, \"KS8tl+JWZX1uwrO2Rqn7YjouoOE=\");\n\n_c = PwdEdit;\nexport default _c2 = withRouter(PwdEdit);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"PwdEdit\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/Gary 1/Desktop/Code stuff/資策會/專題/大專/artddict-react/src/pages/user/PwdEdit.js"],"names":["React","useState","useEffect","withRouter","Link","NavLink","Container","Logoheader","Breadcrumb","swal","PwdEdit","props","userid","match","params","dataLoading","setDataLoading","password","setPassword","newPwd1","setNewPwd1","newPwd2","setNewPwd2","id","setId","console","log","getUserFromServer","url","request","Request","method","headers","Headers","Accept","response","fetch","data","json","checkedPassword","pwd1","pwd2","logoutToSever","localStorage","removeItem","text","icon","button","timer","updatePwdToSever","newData","body","JSON","stringify","setTimeout","loading","display","textDecoration","background","color","event","target","value","getjwtvertifyFromServer","token","getItem","stat","waitAsync","isLoggedin","title","window","location","replace"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { withRouter, Link, NavLink } from 'react-router-dom'\nimport { Container } from 'react-bootstrap'\n// style\nimport './styles/PwdEdit.scss'\n// import Menu2 from './components/Menu2'\nimport Logoheader from './components/Logoheader'\nimport Breadcrumb from './components/UserBreadcrumb'\n// SweetAlert\nimport swal from 'sweetalert'\n\nfunction PwdEdit(props) {\n  const userid = props.match.params.userid\n  const [dataLoading, setDataLoading] = useState(false)\n  const [password, setPassword] = useState('')\n  const [newPwd1, setNewPwd1] = useState('')\n  const [newPwd2, setNewPwd2] = useState('')\n  const [id, setId] = useState('')\n  console.log('before get request')\n  async function getUserFromServer(userid) {\n    // 開啟載入指示\n    setDataLoading(true)\n\n    // 連接的伺服器資料網址\n    const url = 'http://localhost:6005/users/' + userid\n\n    // 注意header資料格式要設定，伺服器才知道是json格式\n    const request = new Request(url, {\n      method: 'GET',\n      headers: new Headers({\n        Accept: 'application/json',\n        'Content-Type': 'appliaction/json',\n      }),\n    })\n\n    const response = await fetch(request)\n    const data = await response.json()\n    console.log(`[GET] response = ${data}`)\n\n    setPassword(data.password)\n    setId(data.id)\n  }\n\n  async function checkedPassword(pwd1, pwd2) {\n    if (pwd1 === pwd2 && pwd2 != '') {\n      return true\n    } else {\n      return false\n    }\n  }\n\n  async function logoutToSever() {\n    // 連接的伺服器資料網址\n    localStorage.removeItem('token')\n    const url = 'http://localhost:6005/users/logout'\n\n    // 注意資料格式要設定，伺服器才知道是json格式\n    const request = new Request(url, {\n      method: 'GET',\n      headers: new Headers({\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      }),\n    })\n\n    // 要等驗証過，再設定資料(簡單的直接設定)\n\n    swal({\n      text: '登出成功！',\n      icon: 'success',\n      button: false,\n      timer: 3000,\n    })\n\n    const response = await fetch(request)\n    // const data = await response.json()\n  }\n\n  async function updatePwdToSever() {\n    // 開啟載入指示\n    setDataLoading(true)\n    // 檢查新密碼==再次輸入密碼\n\n    // 檢查成功, 才送request\n    if (await checkedPassword(newPwd1, newPwd2)) {\n      // var new_password = newPwd1\n      const newData = {\n        password: newPwd1,\n      }\n\n      // 連接的伺服器資料網址 (node端的門牌號碼)\n      // node = http://localhost:6005/users/ + route.get(門牌)\n      // node = http://localhost:6005/users/ + route.put(門牌)\n      // node = http://localhost:6005/users/ + route.post(門牌)\n      const url =\n        'http://localhost:6005/users/pwd/' + userid\n\n      // 以下實際發出request\n      // 注意資料格式要設定，伺服器才知道是json格式\n      const request = new Request(url, {\n        method: 'PUT',\n        body: JSON.stringify(newData),\n        // request:\n        //    header\n        //    body\n        headers: new Headers({\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n        }),\n      })\n      console.log(`request header = ${request.headers}`)\n      console.log(`request body = ${request.body}`)\n\n      // if (newData.password != null) {\n      const response = await fetch(request)\n      const data = await response.json()\n      // } else {\n      //   alert(password)\n      // }\n      // end if\n\n      console.log('伺服器回傳的json資料', data)\n      // 要等驗証過，再設定資料(簡單的直接設定)\n\n      //直接在一段x秒關掉指示器\n      setTimeout(() => {\n        setDataLoading(false)\n        swal({\n          text: '密碼修改成功！！！',\n          icon: 'success',\n          button: false,\n          timer: 3000,\n        })\n      }, 1000)\n    } else {\n      // 抓出了空字串或者兩行不同 警訊以下內容\n      setDataLoading(false)\n      swal({\n        text: '密碼有誤, 請重新檢查',\n        icon: 'error',\n        button: false,\n        timer: 3000,\n      })\n    }\n  }\n\n  // 一開始就會開始載入資料\n  useEffect(() => {\n    getUserFromServer(userid)\n  }, [])\n\n  // 每次users資料有變動就會X秒後關掉載入指示\n  useEffect(() => {\n    setTimeout(() => {\n      setDataLoading(false)\n    }, 1000)\n  }, [userid])\n\n  const loading = (\n    <>\n      <div className=\"u-body\">\n        <Logoheader />\n        <div className=\"d-flex justify-content-center\">\n          <div className=\"spinner-border\" role=\"status\">\n            <span className=\"sr-only\">Loading...</span>\n          </div>\n        </div>\n      </div>\n    </>\n  )\n\n  const display = (\n    <>\n      <div className=\"u-body\">\n        <Logoheader />\n        <div className=\"u-breadcrumb\">\n          <Breadcrumb />\n        </div>\n        {/* <div className=\"u-userMenu d-none d-lg-block d-xl-block\">\n          <Menu2 />\n        </div> */}\n\n        <div className=\"tab-bar\">\n          <NavLink\n            activeClassName=\"activenav\"\n            className={'tab'}\n            to={`/user-msgedit/${id}`}\n            style={{\n              textDecoration: 'none',\n              background: 'black',\n              color: 'white',\n            }}\n          >\n            修改資料\n          </NavLink>\n\n          <NavLink\n            activeClassName=\"activenav\"\n            className={'tab'}\n            to={`/user-orderpro/${id}`}\n            style={{ textDecoration: 'none' }}\n          >\n            訂單查詢\n          </NavLink>\n          <NavLink\n            activeClassName=\"activenav\"\n            className={'tab'}\n            to={`/user-coupon/${id}`}\n            style={{ textDecoration: 'none' }}\n          >\n            我的優惠券\n          </NavLink>\n          <NavLink\n            activeClassName=\"activenav\"\n            className={'tab'}\n            to={`/user-ticket/${id}`}\n            style={{ textDecoration: 'none' }}\n          >\n            我的票券\n          </NavLink>\n          <NavLink\n            activeClassName=\"activenav\"\n            className={'tab'}\n            to={`/user-myfav/${id}`}\n            style={{ textDecoration: 'none' }}\n          >\n            我的收藏\n          </NavLink>\n          <NavLink\n            activeClassName=\"activenav\"\n            className={'tab'}\n            to={`/user-auction/${userid}`}\n            style={{ textDecoration: 'none' }}\n          >\n            競標查詢\n          </NavLink>\n          <NavLink\n            activeClassName=\"activenav\"\n            className={'tab'}\n            to=\"/user-login\"\n            onClick={() => {\n              logoutToSever()\n            }}\n            style={{ textDecoration: 'none' }}\n          >\n            登出\n          </NavLink>\n        </div>\n        <Container fluid>\n          <div className=\"d-flex u-row justify-content-around\">\n            <div className=\"u-usertitleLeft\">\n              <Link to={`/user-msgedit/${id}`}>\n                會員資料\n              </Link>\n            </div>\n            <div className=\"u-usertitleRight\">\n              <Link to={`/user-pwdedit/${id}`}>\n                修改密碼\n              </Link>\n            </div>\n          </div>\n        </Container>\n        <div className=\"u-userData col-6 mt-5\">\n          <form>\n            {/* <div className=\"form-group u-form1\">\n              <input\n                value={password}\n                type=\"text\"\n                className=\"form-control\"\n                onChange={(event) => {\n                  setPassword(event.target.value)\n                }}\n              />\n            </div> */}\n            <div className=\"form-group u-form1 mt-5\">\n              <input\n                value={newPwd1}\n                type=\"password\"\n                className=\"form-control\"\n                placeholder=\"請輸入新密碼\"\n                onChange={(event) => {\n                  setNewPwd1(event.target.value)\n                }}\n              />\n            </div>\n            <div className=\"form-group u-form1 mt-5\">\n              <input\n                value={newPwd2}\n                type=\"password\"\n                className=\"form-control\"\n                placeholder=\"再次輸入新密碼\"\n                onChange={(event) => {\n                  setNewPwd2(event.target.value)\n                }}\n              />\n            </div>\n            <div className=\"u-editBtn\">\n              <button\n                type=\"submit\"\n                className=\"btn btn-outline-dark \"\n                onClick={() => {\n                  updatePwdToSever()\n                }}\n              >\n                修改\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  )\n  async function getjwtvertifyFromServer() {\n    const token = localStorage.getItem('token')\n\n    const response = await fetch(\n      'http://localhost:6005/users/checklogin',\n      {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          token,\n        }),\n      }\n    )\n\n    const data = await response.json()\n    console.log('check login response = ', data)\n    console.log('data.id = ', data.id)\n    console.log('userid = ', userid)\n    if (data.id == userid) {\n      var stat = true\n    } else {\n      var stat = false\n    }\n    console.log('stat = ', stat)\n    return stat\n  }\n\n  // async needs to be waited in another funciton\n  const waitAsync = async () => {\n    const isLoggedin = await getjwtvertifyFromServer()\n\n    if (!isLoggedin) {\n      console.log('no display!')\n      swal({\n        title: '登入驗證失敗',\n        text: '您的登入驗證已過期或者尚未登入, 請重新登入\\n正在將您導向登入頁面 ...',\n        button: false,\n        timer: 2000,\n      })\n      setTimeout(() => {\n        window.location.replace(`../user-login/`)\n      }, 500)\n      // throw new Error('Oopsie woopsie')\n    }\n  }\n\n  if (waitAsync()) {\n    // setDataLoading(true)\n    console.log('display!')\n\n    return <>{dataLoading ? loading : display}</>\n  }\n}\nexport default withRouter(PwdEdit)\n"]},"metadata":{},"sourceType":"module"}